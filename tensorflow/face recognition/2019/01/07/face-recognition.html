<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Face Recognition | Overfitted</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Face Recognition" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learn to create Face Recognition system from scratch" />
<meta property="og:description" content="Learn to create Face Recognition system from scratch" />
<link rel="canonical" href="https://blog.aniketmaurya.ml/tensorflow/face%20recognition/2019/01/07/face-recognition.html" />
<meta property="og:url" content="https://blog.aniketmaurya.ml/tensorflow/face%20recognition/2019/01/07/face-recognition.html" />
<meta property="og:site_name" content="Overfitted" />
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2000/1*t3DEmVOWOuWjIo_TjcpxNQ.gif" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-07T00:00:00-06:00" />
<script type="application/ld+json">
{"datePublished":"2019-01-07T00:00:00-06:00","headline":"Face Recognition","image":"https://cdn-images-1.medium.com/max/2000/1*t3DEmVOWOuWjIo_TjcpxNQ.gif","description":"Learn to create Face Recognition system from scratch","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.aniketmaurya.ml/tensorflow/face%20recognition/2019/01/07/face-recognition.html"},"@type":"BlogPosting","url":"https://blog.aniketmaurya.ml/tensorflow/face%20recognition/2019/01/07/face-recognition.html","dateModified":"2019-01-07T00:00:00-06:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.aniketmaurya.ml/feed.xml" title="Overfitted" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-156199072-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Face Recognition | Overfitted</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Face Recognition" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learn to create Face Recognition system from scratch" />
<meta property="og:description" content="Learn to create Face Recognition system from scratch" />
<link rel="canonical" href="https://blog.aniketmaurya.ml/tensorflow/face%20recognition/2019/01/07/face-recognition.html" />
<meta property="og:url" content="https://blog.aniketmaurya.ml/tensorflow/face%20recognition/2019/01/07/face-recognition.html" />
<meta property="og:site_name" content="Overfitted" />
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2000/1*t3DEmVOWOuWjIo_TjcpxNQ.gif" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-07T00:00:00-06:00" />
<script type="application/ld+json">
{"datePublished":"2019-01-07T00:00:00-06:00","headline":"Face Recognition","image":"https://cdn-images-1.medium.com/max/2000/1*t3DEmVOWOuWjIo_TjcpxNQ.gif","description":"Learn to create Face Recognition system from scratch","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.aniketmaurya.ml/tensorflow/face%20recognition/2019/01/07/face-recognition.html"},"@type":"BlogPosting","url":"https://blog.aniketmaurya.ml/tensorflow/face%20recognition/2019/01/07/face-recognition.html","dateModified":"2019-01-07T00:00:00-06:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://blog.aniketmaurya.ml/feed.xml" title="Overfitted" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-156199072-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Overfitted</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Face Recognition</h1><p class="page-description">Learn to create Face Recognition system from scratch</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2019-01-07T00:00:00-06:00" itemprop="datePublished">
        Jan 7, 2019
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#Tensorflow">Tensorflow</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#Face Recognition">Face Recognition</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#face-verification-vs-face-recognition">Face Verification vs. Face Recognition</a></li>
<li class="toc-entry toc-h2"><a href="#why-pixel-by-pixel-comparison-of-images-isabadidea">Why pixel-by-pixel comparison of images is a bad idea?</a></li>
<li class="toc-entry toc-h2"><a href="#face-embedding-come-to-the-rescue">Face Embedding come to the rescue</a>
<ul>
<li class="toc-entry toc-h3"><a href="#how-to-finetune-embeddings">How to finetune embeddings?</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#face-verification">Face Verification</a></li>
<li class="toc-entry toc-h2"><a href="#face-recognition">Face Recognition</a></li>
</ul><p>AI is revolutionizing the world. Face recognition is one such spectrum of it. Almost everyone uses face recognition systems — on our mobile, Facebook, Photo gallery apps or advanced security cameras. Learn how these systems are able to recognize our faces.</p>

<p><em>This article is inspired by the deeplearning.ai course on FaceNet.</em></p>

<p><img src="https://cdn-images-1.medium.com/max/2000/1*t3DEmVOWOuWjIo_TjcpxNQ.gif" alt=""></p>

<h2 id="face-verification-vs-face-recognition">
<a class="anchor" href="#face-verification-vs-face-recognition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Face Verification vs. Face Recognition</h2>

<p><strong>Face Verification</strong> checks “is this the claimed person?”. For example, in school, you go with your ID card and the invigilator verifies your face with the ID card. This is Face Verification. A mobile phone that unlocks using our face is also using face verification. It is 1:1 matching problem.</p>

<p>Now suppose the invigilator knows everyone by their name. So, you decide to go there without an ID card. The invigilator identifies your face and lets you in. This is Face Recognition. <strong>Face Recognition</strong> deals with “who is this person?” problem. We can say that it is a 1:K problem.</p>

<h2 id="why-pixel-by-pixel-comparison-of-images-isabadidea">
<a class="anchor" href="#why-pixel-by-pixel-comparison-of-images-isabadidea" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why pixel-by-pixel comparison of images is a bad idea?</h2>

<p>A simple way for face verification can be comparing two images pixel-by-pixel and if the threshold between images is less than a threshold then we can say that they’re the same person. But since the pixel values in an image change dramatically even with a slight change of light, position or orientation. So, this method doesn’t work well.</p>

<h2 id="face-embedding-come-to-the-rescue">
<a class="anchor" href="#face-embedding-come-to-the-rescue" aria-hidden="true"><span class="octicon octicon-link"></span></a>Face Embedding come to the rescue</h2>

<p>The <em>embedding</em> is represented by f (x), a d-dimensional vector. It encodes an image ‘x’ into a d-dimensional Euclidean space. The face embedding of two images of the same person are similar to each other and that of different persons are very different.</p>

<p>In ConvNet architectures, the initial layers learn to recognize basic patterns like straight lines, edges, circles, etc. and the deeper layers learn to recognize more complex patterns like numbers, faces, cars, etc.</p>

<p>To get our embedding we feed the image into a pre-trained model then run a forward propagation and extract the vector from some deeper Fully-Connected layer. You can learn the basics of CNN <a href="https://medium.com/@aniketmaurya/not-just-introduction-to-convolutional-neural-networks-part-2-a7ac2723e30d">here</a>.</p>

<h3 id="how-to-finetune-embeddings">
<a class="anchor" href="#how-to-finetune-embeddings" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to finetune embeddings?</h3>

<p><em><a href="https://en.wikipedia.org/wiki/Triplet_loss">The Triplet Loss</a></em> function takes the responsibility to <em>push</em> the embeddings of two images of the same person (Anchor and Positive) closer together while <em>pulling</em> the embeddings of two images of different persons (Anchor, Negative) further apart.</p>

<p><img src="https://cdn-images-1.medium.com/max/3840/1*CKnxCH4SNOnTqctwX-ViKQ.png" alt="Source: [Coursera](http://deeplearning.ai)"><em>Source: <a href="http://deeplearning.ai">Coursera</a></em></p>

<p>$||f(X1) — f(X2)||²$ is the degree of similarity between image X1 and X2. If it’s smaller than a chosen threshold then both are the same person.</p>

<p>If you’re wondering “what this $|A|$ weird symbol is?”, it’s called <em>Frobenius Norm</em>.</p>

<p>The distance between <em>Anchor</em> and <em>Positive</em> images should be less and the distance between <em>Anchor</em> and <em>Negative</em> images should be high.</p>

<p>i.e. $∥f(Anchor) — f(Positive)∥² ≤ ∥f(Anchor) — f(Negative)∥²$.</p>

<p>Training a Face recognition model is computationally expensive so it’s recommended to download a <a href="https://github.com/iwantooxxoox/Keras-OpenFace">pre-trained model</a>.</p>

<p>Start with creating a database of persons containing an embedding vector for each.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#create a dictionary database
</span><span class="n">db</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="c1">#encoding(image_path) converts image to embedding
</span><span class="n">db</span><span class="p">[</span><span class="s">'person1'</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">(</span><span class="s">'person1.jpg'</span><span class="p">)</span>
<span class="n">db</span><span class="p">[</span><span class="s">'person2'</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">(</span><span class="s">'person2.jpg'</span><span class="p">)</span>
<span class="n">db</span><span class="p">[</span><span class="s">'person3'</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">(</span><span class="s">'person3.jpg'</span><span class="p">)</span>
<span class="n">db</span><span class="p">[</span><span class="s">'person4'</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">(</span><span class="s">'person4.jpg'</span><span class="p">)</span>
<span class="n">db</span><span class="p">[</span><span class="s">'person5'</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">(</span><span class="s">'person5.jpg'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="face-verification">
<a class="anchor" href="#face-verification" aria-hidden="true"><span class="octicon octicon-link"></span></a>Face Verification</h2>
<p>Now that we have created our database, we can define a function that accepts image embedding and name of the person as the argument and it will verify if they are the same person.</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="n">person_name</span><span class="p">):</span>
        
    <span class="c1"># numpy.linalg.norm calculates the Frobenius Norm
</span>    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">embedding</span> <span class="o">-</span> <span class="n">db</span><span class="p">[</span><span class="n">person_name</span><span class="p">])</span>
    
    <span class="c1"># Chosen threshold is 0.7  
</span>    <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Verified! Welcome "</span> <span class="o">+</span> <span class="n">person_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Person name and face didn't match!"</span><span class="p">)</span>
</code></pre></div></div>
<p>Hurray 😎! We created our Face Verification system. Now let’s create the Face Recognition System. If you remember, a person doesn’t need any ID in the face recognition system. He just needs to show his face to the camera.</p>

<h2 id="face-recognition">
<a class="anchor" href="#face-recognition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Face Recognition</h2>

<p>In Face recognition, the distance will be calculated for all the images in the database against the input embedding and the smallest distance has to be searched.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">recognize_me</span><span class="p">(</span><span class="n">input_embedding</span><span class="p">):</span>

    <span class="c1"># Set min_dist to infinity
</span>    <span class="n">min_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="c1"># Iterate over the database to calulate distance for each person*
</span>    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">emb</span><span class="p">)</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        
        <span class="c1"># Compute the distance*
</span>        <span class="n">curr_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">input_embedding</span> <span class="o">-</span> <span class="n">emb</span><span class="p">)</span>

        <span class="c1"># identity is set to the name of the person from the database whose distance is smallest against the input encoding
</span>        <span class="k">if</span> <span class="n">curr_dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span>
            <span class="n">min_dist</span> <span class="o">=</span> <span class="n">curr_dist</span>
            <span class="n">identity</span> <span class="o">=</span> <span class="n">name</span>
    
    <span class="k">if</span> <span class="n">min_dist</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Sorry! You’re not in the database."</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">"Hi! Welcome "</span> <span class="o">+</span> <span class="n">identity</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>Congratulations!! 👏👏 You have created your own Face Recognition system.</p>
</blockquote>

<p>You can provide your feedback in comment section below.</p>

<p><strong>Follow me on <a href="https://twitter.com/aniketmauryaTwitter">Twitter</a></strong></p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="aniketmaurya/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/tensorflow/face%20recognition/2019/01/07/face-recognition.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Blogs on Machine Learning and Programming.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/aniketmaurya" title="aniketmaurya"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/aniketmaurya" title="aniketmaurya"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
